<script setup lang="ts">
import { computed, toRefs } from 'vue';
import { WithdrawMathResponse } from '../composables/useWithdrawMath';
import useNumbers, { FNumFormats } from '@/composables/useNumbers';

/**
 * TYPES
 */
type Props = {
  math: WithdrawMathResponse;
};

/**
 * Props
 */
const props = defineProps<Props>();

/**
 * COMPOSABLES
 */
const { fNum2 } = useNumbers();

const { priceImpact, highPriceImpact, loadingAmountsOut } = toRefs(props.math);

/**
 * COMPUTED
 */
const priceImpactClasses = computed(() => ({
  'bg-red-500 text-white divide-red-400 border-none': highPriceImpact.value
}));
</script>

<template>
  <div class="data-table">
    <div :class="['data-table-row', priceImpactClasses]">
      <div class="p-2" style="border-color: #d8ceb5;">
        {{ $t('priceImpact') }}
      </div>
      <div class="data-table-number-col" style="border-color: #d8ceb5;">
        <div class="flex items-center">
          <BalLoadingBlock v-if="loadingAmountsOut" class="w-10 h-6" />
          <span v-else>{{ fNum2(priceImpact, FNumFormats.percent) }}</span>

          <BalTooltip :text="$t('withdraw.tooltips.priceImpact')">
            <template v-slot:activator>
              <BalIcon
                v-if="highPriceImpact"
                name="alert-triangle"
                size="xs"
                class="-mb-px ml-1"
              />
              <BalIcon
                v-else
                name="info"
                size="xs"
                class="text-gray-400 -mb-px ml-1"
              />
            </template>
          </BalTooltip>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.data-table {
  @apply rounded-lg divide-y;
}

.data-table-row {
  @apply flex;
  @apply rounded-lg;
  @apply divide-x border;
  border-color: #d8ceb5;
  background: #fef7e5;
}

.data-table-number-col {
  @apply p-2 flex flex-grow items-center justify-between;
}

.total-row {
  @apply text-lg font-bold;
}
</style>
